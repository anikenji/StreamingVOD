RewriteEngine On
RewriteBase /StreamingVOD/

# Enable CORS for video files
<FilesMatch "\.(m3u8|ts|mp4)$">
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
</FilesMatch>

# Don't rewrite if already in public or api
RewriteCond %{REQUEST_URI} ^/StreamingVOD/public/ [OR]
RewriteCond %{REQUEST_URI} ^/StreamingVOD/api/
RewriteRule ^ - [L]

# Redirect root to public directory
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ public/$1 [L]

# Embed route
RewriteRule ^embed/([a-zA-Z0-9-]+)$ public/embed.php?id=$1 [L,QSA]
